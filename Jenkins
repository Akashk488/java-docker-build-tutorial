pipeline{
    agent any
    tools{
        maven 'maven'
        
    }
    stages{
        stage ('checkout_scm'){
        steps{
            checkout scm
        }
        }

        stage ('Maven_Build'){
        steps{
            sh 'mvn clean package'
        }
        }       

        stage ('Docker Build'){
        steps{
            script{
            withDockerRegistry(credentialsId: 'docker-token', url: 'https://akashk.azurecr.io') {
                sh 'sudo docker build -t akashk.azurecr.io/java-docker-build:latest .'  
                }  
            
        }
        }
        }

        stage ('Docker push'){
        steps{
           script{
            withDockerRegistry(credentialsId: 'docker-token', url: 'https://akashk.azurecr.io') {
                sh 'sudo docker push akashk.azurecr.io/java-docker-build:latest'
                }
           }
            
        }
        }
    }   

}
